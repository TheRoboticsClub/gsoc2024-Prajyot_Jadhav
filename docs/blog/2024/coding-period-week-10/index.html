<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Week 10: July 29 ~ August 04 | Prajyot Jadhav | JdeRobot x GSoC 2024 </title> <meta name="author" content="JdeRobot | GSoC 2024"> <meta name="description" content="Fixing issues with the functionality of the Play, Pause, and Reset buttons for the Gz Harmonic exercise"> <link rel="stylesheet" href="/gsoc2024-Prajyot_Jadhav/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/gsoc2024-Prajyot_Jadhav/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/gsoc2024-Prajyot_Jadhav/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/gsoc2024-Prajyot_Jadhav/assets/img/file.png?a4d243233aa137889e20a6fc4a0d83a2"> <link rel="stylesheet" href="/gsoc2024-Prajyot_Jadhav/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://theroboticsclub.github.io/gsoc2024-Prajyot_Jadhav/blog/2024/coding-period-week-10/"> <script src="/gsoc2024-Prajyot_Jadhav/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/gsoc2024-Prajyot_Jadhav/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/gsoc2024-Prajyot_Jadhav/"> Prajyot Jadhav | JdeRobot x GSoC 2024 </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-Prajyot_Jadhav/">home </a> </li> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-Prajyot_Jadhav/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-Prajyot_Jadhav/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/gsoc2024-Prajyot_Jadhav/report/">report </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Week 10: July 29 ~ August 04</h1> <p class="post-meta"> Created in August 06, 2024 </p> <p class="post-tags"> <a href="/gsoc2024-Prajyot_Jadhav/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h4 id="objectives">Objectives</h4> <ul class="task-list"> <li class="task-list-item"> <input type="checkbox" class="task-list-item-checkbox" disabled checked>Resolving functionality issues with the Play and Pause buttons</li> <li class="task-list-item"> <input type="checkbox" class="task-list-item-checkbox" disabled>Addressing and fixing problems related to the Reset button’s operation (solved partially)</li> </ul> <h4 id="work-done">Work Done</h4> <p>In the previous week, I encountered issues where images on the GUI server were not updating as expected. Additionally, the Play button failed to toggle to Pause when the application was running, and the Reset button remained grayed out.</p> <p>Upon investigation, I identified the potential cause within the Robotics Application Manager, specifically within the <code class="language-plaintext highlighter-rouge">run_application</code>, <code class="language-plaintext highlighter-rouge">pause</code>, <code class="language-plaintext highlighter-rouge">resume</code>, and <code class="language-plaintext highlighter-rouge">terminate</code> transitions. In the <code class="language-plaintext highlighter-rouge">run_application</code> transition, the <code class="language-plaintext highlighter-rouge">unpause_sim</code> function was being called, while the <code class="language-plaintext highlighter-rouge">pause_sim</code> and <code class="language-plaintext highlighter-rouge">reset_sim</code> functions were invoked in the <code class="language-plaintext highlighter-rouge">terminate</code> transition.</p> <p>For the Gazebo Classic simulator integrated with ROS 2, pausing, unpausing, and resetting simulations are managed through ROS 2 services. The following commands are used in the command line:</p> <ul> <li>To ( un )pause: <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>ros2 service call /(un)pause_physics std_srvs/srv/Empty
</code></pre></div> </div> </li> <li>To reset: <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>ros2 service call /reset_world std_srvs/srv/Empty
</code></pre></div> </div> </li> </ul> <p>However, in the newer Gazebo Sim, the approach has shifted from ROS 2 services to Gazebo (gz) services for these operations.</p> <p>A Gazebo transport API is now available for starting, stopping, and resetting the simulation. This is done via the command line by calling the service <code class="language-plaintext highlighter-rouge">/world/&lt;world_name&gt;/control</code> and filling the request with the message type <code class="language-plaintext highlighter-rouge">gz.msgs.WorldControl</code>. This service responds with a <code class="language-plaintext highlighter-rouge">gz.msgs.Boolean</code> indicating the success (<code class="language-plaintext highlighter-rouge">true</code>) or failure (<code class="language-plaintext highlighter-rouge">false</code>) of the request.</p> <p>To control the simulation:</p> <ul> <li> <strong>Start the simulation:</strong> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>gz service -s /world/&lt;world_name&gt;/control --reqtype gz.msgs.WorldControl --reptype gz.msgs.Boolean --timeout 3000 --req 'pause: false'
</code></pre></div> </div> </li> <li> <strong>Pause the simulation:</strong> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>gz service -s /world/&lt;world_name&gt;/control --reqtype gz.msgs.WorldControl --reptype gz.msgs.Boolean --timeout 3000 --req 'pause: true'
</code></pre></div> </div> </li> <li> <strong>Reset the simulation:</strong> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>gz service -s /world/&lt;world_name&gt;/control --reqtype gz.msgs.WorldControl --reptype gz.msgs.Boolean --timeout 3000 --req 'reset: {all: true}'
</code></pre></div> </div> </li> </ul> <p>The reset operation, similar to the pause and unpause commands, is managed through the same service. The <code class="language-plaintext highlighter-rouge">reset</code> field in the <code class="language-plaintext highlighter-rouge">gz.msgs.WorldControl</code> message allows you to reset the world to time zero. When executed, this command stops the simulation and resets the world state, with the success of the request indicated by the returned Boolean value.</p> <p>Since the Gazebo (gz) services include the <code class="language-plaintext highlighter-rouge">&lt;world_name&gt;</code> in their paths, I implemented a solution to ensure compatibility across different exercises with varying world names. I used a regular expression <code class="language-plaintext highlighter-rouge">$(gz service -l | grep '^/world/\w*/control$')</code> to dynamically identify the correct service name from the available services. This approach works well, as only one exercise is run at a time, each with its specific world name.</p> <p>I then updated the <code class="language-plaintext highlighter-rouge">unpause_sim</code> and <code class="language-plaintext highlighter-rouge">pause_sim</code> functions in the RoboticsApplicationManager for <code class="language-plaintext highlighter-rouge">visualization_type</code> as <code class="language-plaintext highlighter-rouge">gzsim_rae</code>. With these updates, I successfully resolved the issues related to the Play/Pause functionality and the problem with static images.</p> <div class="row mt-3 justify-content-center"> <div class="col-lg-10 mt-3 mt-md-0"> <figure> <video src="/gsoc2024-Prajyot_Jadhav/assets/video/week10vdo1.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" controls=""></video> </figure> </div> </div> <div class="caption"> Play/Pause Functionality Demonstration </div> <p>However, when I applied similar updates to the <code class="language-plaintext highlighter-rouge">reset_sim</code> function, the simulation didn’t perform as expected, and Gazebo Sim crashed. The service worked fine with basic simulation environments but specifically failed when using Aerostack2. After discussing this with the mentors, we suspected that the issue might be related to the Aerostack2 bridges not being reset correctly.</p> <p>To work around this problem, I initially attempted to delete the quadrotor model and respawn it at its initial position, but this also caused the simulation to crash. Instead, I implemented a solution that involves resetting the pose of the quadrotor model to its initial position when the reset button is clicked. This approach works well since, in the Rescue People exercise, the quadrotor is the only dynamic model in the simulation environment.</p> <p>The command to reset the drone’s position is:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gz service -s /world/&lt;world_name&gt;/set_pose --reqtype gz.msgs.Pose --reptype gz.msgs.Boolean --timeout 300 --req 'name: "drone0", position: {x: 0, y: 0, z: 0}'
</code></pre></div></div> <p>This successfully resets the drone to its initial position. However, I’ve encountered a new issue: when re-running the code after resetting, the drone doesn’t perform a takeoff and instead directly moves to the setpoint position. I will investigate and try to resolve this next.</p> <div class="row mt-3 justify-content-center"> <div class="col-lg-10 mt-3 mt-md-0"> <figure> <video src="/gsoc2024-Prajyot_Jadhav/assets/video/week10vdo2.mp4" class="img-fluid rounded z-depth-1" width="auto" height="auto" controls=""></video> </figure> </div> </div> <div class="caption"> Reset Functionality: Quadrotor Returning to Initial Position </div> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/gsoc2024-Prajyot_Jadhav/blog/2024/coding-period-week-11-12/">Week 11 and Week 12: August 05 ~ August 18</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/gsoc2024-Prajyot_Jadhav/blog/2024/coding-period-week-8-9/">Week 8 and Week 9: July 15 ~ July 28</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/gsoc2024-Prajyot_Jadhav/blog/2024/coding-period-week-7/">Week 7: July 08 ~ July 14</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/gsoc2024-Prajyot_Jadhav/blog/2024/coding-period-week-5-6/">Week 5 and Week 6: June 24 ~ July 07</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/gsoc2024-Prajyot_Jadhav/blog/2024/coding-period-week-4/">Week 4: June 17 ~ June 23</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 JdeRobot | GSoC 2024. RoboticsAcademy: Migration to Gazebo Harmonic Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/gsoc2024-Prajyot_Jadhav/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/gsoc2024-Prajyot_Jadhav/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/gsoc2024-Prajyot_Jadhav/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/gsoc2024-Prajyot_Jadhav/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/gsoc2024-Prajyot_Jadhav/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/gsoc2024-Prajyot_Jadhav/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/gsoc2024-Prajyot_Jadhav/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/gsoc2024-Prajyot_Jadhav/assets/js/vanilla-back-to-top.min.js?fa0110e8b42cec56ce96d912fd4bde74"></script> <script>addBackToTop();</script> </body> </html>